<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="Drawer.js"></script><!--helper class for drawing-->
    <script src="Editor.js"></script>
    <style>
      
    </style>
    <link rel="stylesheet" href="tab.css" />
  </head>
  <svg id="draw" height="10000">
  </svg>
  <script>
    //hardcoded crazy train, rhythm things, and another one bites the dust, for ease of editing
    tab={
      info:{
        title: "crazy train",
        author: "andy roads",
        album: "blizzard of Oz"
      },
      tracks:[
        {
          name: "andy on lead",
          voice: "guitar_distort",
          stringN: 6,
          st0: "E4",
          st1: "B4",
          st2: "G3",
          st3: "D3",
          st4: "A3",
          st5: "E2"
        }
      ],
      measures:[ //measure info, then note info for each of the tracks
        {///measure 1
          timeN: 4,
          timeD: 4,
          tempo: 160,
          tracks: [ //list of tracks
            [//list of beats in track 0
              {
                duration: 0, //0 corresponds to 8th notes
                notes: [//notes
                  {
                    string: 5,
                    fret: 2
                  }
                ]
              },
              {duration: 0, notes: [{string: 5, fret: 2}]},
              {duration: 0, notes: [{string: 4, fret: 4}]},
              {duration: 0, notes: [{string: 5, fret: 2}]},
              {duration: 0, notes: [{string: 4, fret: 5}]},
              {duration: 0, notes: [{string: 5, fret: 2}]},
              {duration: 0, notes: [{string: 4, fret: 4}]},
              {duration: 0, notes: [{string: 5, fret: 2}]},
            ]
          ]
        },
        {//measure 2
          timeN: 4,timeD: 4,tempo: 160,
          tracks: [
            [//beats in track 1
              {duration: 0, notes: [{string: 4, fret: 2}]},
              {duration: 0, notes: [{string: 5, fret: 5}]},
              {duration: 0, notes: [{string: 5, fret: 4}]},
              {duration: 0, notes: [{string: 5, fret: 5}]},
              {duration: 0, notes: [{string: 4, fret: 2}]},
              {duration: 0, notes: [{string: 5, fret: 5}]},
              {duration: 0, notes: [{string: 5, fret: 4}]},
              {duration: 0, notes: [{string: 5, fret: 0}]},
            ]
          ]
        },
        {timeN:127,timeD:64,tempo:100,
          tracks: [[
            {duration: -3, notes:[{string:5,fret:0}]},//64th
            {duration: -2, notes:[{string:5,fret:0}]},//32nd
            {duration: -1, notes:[{string:5,fret:0}]},//16th
            {duration: 0, notes:[{string:5,fret:0}]}, //8th
            {duration: 1, notes:[{string:5,fret:0}]}, //quarter
            {duration: 2, notes:[{string:5,fret:0}]}, //half
            {duration: 3, notes:[{string:5,fret:0}]}  //whole
          ]]
        },//another one bites the dust, half 1
        {timeN:4,timeD:4,tempo:120,
          tracks:[[
            {duration: 0, notes:[{string:4,fret:7}]},
            {duration: 0, notes:[]}, //rest for an 8th note
            {duration: 0, notes:[{string:4,fret:7}]},
            {duration: 0, notes:[]}, //rest for an 8th note
            {duration: 0, notes:[{string:4,fret:7}]},
            {duration: 1, notes:[]}, //quarter rest
            {duration: -1,notes:[]}, //16th rest
            {duration: -1,notes:[{string:4,fret:7}]} //quick grace note
          ]]
        },//second half of another one bites the dust
        {timeN:4,timeD:4,tempo:120,
          tracks:[[ //technically not exactly how this measure goes, but here's the simplified version
            {duration: 0, notes:[{string:4,fret:7}]},
            {duration: 0, notes:[{string:4,fret:7}]},
            {duration: 0, notes:[{string:3,fret:5}]},
            {duration: 0, notes:[{string:4,fret:7}]},
            {duration: 0, notes:[{string:3,fret:7}]},
            {duration: 1, notes:[]}, //dotted quarter rest
            {duration: 0, notes:[]}
          ]]
        }
      ]
    }
  </script>
  <script>
    var drawer; //class for working with svg elements
    var editor; //class for handling user input and affecting the "tab" object

    var inDraw=false; //boolean for if the mouse is in the <svg></svg> area

    $(function(){
      var windowWidth=document.body.clientWidth;
      $("#draw").width(windowWidth);
      drawer=new Drawer(tab,document.getElementById("draw"),windowWidth);
      editor=new Editor(tab,0);
      drawer.drawTab(0);
    });

    //when a fret is dynamically added, it has a call to this function with the correct arguments
    //structure of the "note" variable: [measure,beat,string]
    /*function selectNote(x,y,note=null){
      //console.log("clicked "+note+" at ("+x+","+y+")");
      drawer.drawSelector(document.getElementById("draw"),x,y);
      editor.select(note);
    }*/
    function selectNote(id){
      //console.log(id);
      drawer.drawSelector(id);
      editor.select(id);
    }

    $("#draw").mouseenter(()=>{inDraw=true});
    $("#draw").mouseleave(()=>{inDraw=false});
    $("body").keydown((event)=>{
      if(inDraw){ //don't use the editor if they pressed a key outside the editor
        if([32,37,38,39,40].indexOf(event.keyCode)>-1){
          //prevent arrow keys and space from scrolling the page
          event.preventDefault();
        }
        editor.handleKey(event.which);
        drawer.drawTab(0);
        drawer.drawSelector(editor.selected);
      }
    });
  </script>
</html>