<html>
	<head>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
		<script src="Drawer.js"></script><!--class for drawing the tab-->
		<script src="Editor.js"></script><!--class for editing the tab-->
		<script src="Player.js"></script><!--class for playing the tab-->
		<script src="userInput.js"></script><!--contains functions to handle user input-->
		<link rel="stylesheet" href="tab.css" />
	</head>
	<body>
		<!--TODO: make this part cleaner-->
		<p>Current Track:
			<select id="trackSelector" onchange="changeTrack()">
			</select> <!--loads dynamically below-->
		</p>

		<svg id="draw" height="10000">
		</svg>
		<script>
			//hardcoded crazy train, rhythm things, and another one bites the dust, for ease of editing
			hardcodedTab={
				info:{
					title: "crazy train",
					author: "andy roads",
					album: "blizzard of Oz"
				},
				tracks:[
					{
						name: "andy on lead",
						voice: "guitar_distort",
						stringN: 6, //TODO: maybe just change it to a list/array?
						st0: "E4",
						st1: "B4",
						st2: "G3",
						st3: "D3",
						st4: "A3",
						st5: "E2"
					},
					{
						name: "bass guy",
						voice: "bass_picked",
						stringN: 4,
						st0: "G2",
						st1: "D2",
						st2: "A2",
						st3: "E1"
					}
				],
				measures:[ //measure info, then note info for each of the tracks
					{///measure 1
						timeN: 4,
						timeD: 4,
						tempo: 160,
						tracks: [ //list of tracks
							[//list of beats in track 0
								{
									duration: 8, //an 8th note
									notes: [
										{
											string: 5,
											fret: 2
										}
									]
								},
								{duration: 8, notes: [{string: 5, fret: 2}]},
								{duration: 8, notes: [{string: 4, fret: 4}]},
								{duration: 8, notes: [{string: 5, fret: 2}]},
								{duration: 8, notes: [{string: 4, fret: 5}]},
								{duration: 8, notes: [{string: 5, fret: 2}]},
								{duration: 8, notes: [{string: 4, fret: 4}]},
								{duration: 8, notes: [{string: 5, fret: 2}]},
							],[//notes for track 2 (bass)
								{duration: 8,notes:[{string:3,fret:2}]},
								{duration: 8,notes:[{string:3,fret:2}]},
								{duration: 2,notes:[]}, //these two are
								{duration: 4,notes:[]}, //a dotted half rest
							]
						]
					},
					{//measure 2
						timeN: 4,timeD: 4,tempo: 160,
						tracks: [
							[//beats in track 1
								{duration: 8, notes: [{string: 4, fret: 2}]},
								{duration: 8, notes: [{string: 5, fret: 5}]},
								{duration: 8, notes: [{string: 5, fret: 4}]},
								{duration: 8, notes: [{string: 5, fret: 5}]},
								{duration: 8, notes: [{string: 4, fret: 2}]},
								{duration: 8, notes: [{string: 5, fret: 5}]},
								{duration: 8, notes: [{string: 5, fret: 4}]},
								{duration: 8, notes: [{string: 5, fret: 0}]},
							],
							[
								{duration: 8,notes:[{string:2,fret:5}]},
								{duration: 8,notes:[{string:2,fret:5}]},
								{duration: 4,notes:[]},
								{duration: 8,notes:[{string:3,fret:0}]},
								{duration: 8,notes:[{string:3,fret:0}]},
								{duration: 4,notes:[]},
							]
						]
					},
					/*{timeN:127,timeD:64,tempo:100,
						tracks: [[
							{duration: 64, notes:[{string:5,fret:0}]},//64th
							{duration: 32, notes:[{string:5,fret:0}]},//32nd
							{duration: 16, notes:[{string:5,fret:0}]},//16th
							{duration: 8, notes:[{string:5,fret:0}]}, //8th
							{duration: 4, notes:[{string:5,fret:0}]}, //quarter
							{duration: 2, notes:[{string:5,fret:0}]}, //half
							{duration: 1, notes:[{string:5,fret:0}]}  //whole
						]]
					},*/
					{timeN:4,timeD:4,tempo:120, //another one bites the dust, half 1
						tracks:[
						[
								{duration: 8, notes:[{string:4,fret:7}]},
								{duration: 8, notes:[]}, //rest for an 8th note
								{duration: 8, notes:[{string:4,fret:7}]},
								{duration: 8, notes:[]}, //rest for an 8th note
								{duration: 8, notes:[{string:4,fret:7}]},
								{duration: 4, notes:[]}, //quarter rest
								{duration: 16,notes:[]}, //16th rest
								{duration: 16,notes:[{string:4,fret:7}]} //quick grace note
							],
							[
								{duration: 8, notes:[{string:2,fret:7}]},
								{duration: 8, notes:[]}, //rest for an 8th note
								{duration: 8, notes:[{string:2,fret:7}]},
								{duration: 8, notes:[]}, //rest for an 8th note
								{duration: 8, notes:[{string:2,fret:7}]},
								{duration: 4, notes:[]}, //quarter rest
								{duration: 16,notes:[]}, //16th rest
								{duration: 16,notes:[{string:2,fret:7}]} //quick grace note
							]
						]
					},//second half of another one bites the dust
					{timeN:4,timeD:4,tempo:120,
						tracks:[
							[ //technically not exactly how this measure goes, but here's the simplified version
								{duration: 8, notes:[{string:4,fret:7}]},
								{duration: 8, notes:[{string:4,fret:7}]},
								{duration: 8, notes:[{string:3,fret:5}]},
								{duration: 8, notes:[{string:4,fret:7}]},
								{duration: 8, notes:[{string:3,fret:7}]},
								{duration: 4, notes:[]}, //dotted quarter rest
								{duration: 8, notes:[]}
							],
							[ //technically not exactly how this measure goes, but here's the simplified version
								{duration: 8, notes:[{string:2,fret:7}]},
								{duration: 8, notes:[{string:2,fret:7}]},
								{duration: 8, notes:[{string:1,fret:5}]},
								{duration: 8, notes:[{string:2,fret:7}]},
								{duration: 8, notes:[{string:1,fret:7}]},
								{duration: 4, notes:[]}, //dotted quarter rest
								{duration: 8, notes:[]}
							]
						]
					}
				]
			}
		</script>
		<script>
			var tab; //the tab, big ol js object (currently hardcoded above)
			var drawer; //class for working with svg elements
			var editor; //class for handling user input and affecting the "tab" object
			var player; //class for playing the notes back to the user, may be deleted in favor of rendering a .mp3 file on the server for potential performance and parallelism issues

			var inDraw=false; //boolean for if the mouse is in the <svg></svg> area
			var currTrack=0;//start with the first by default

			$(function(){
				var windowWidth=document.body.clientWidth;
				$("#draw").width(windowWidth);
				tab=loadTab();
				drawer=new Drawer(tab,document.getElementById("draw"),windowWidth);
				editor=new Editor(tab,currTrack);
				player=new Player(tab);
				drawer.drawTab(currTrack);
			});

			function loadTab(){
				var loadedTab=hardcodedTab;

				//load dropdown of tracks
				for(var i=0;i<loadedTab.tracks.length;i++){
					var input=document.createElement("option");
					input.setAttribute("value",i);
					input.textContent=loadedTab.tracks[i].name;
					document.getElementById("trackSelector").appendChild(input);
				}

				return loadedTab;
			}

			$("#draw").mouseenter(()=>{inDraw=true});
			$("#draw").mouseleave(()=>{inDraw=false});
			$("body").keydown((event)=>{
				if(inDraw){ //don't use the editor if they pressed a key outside the editor
					if([32,37,38,39,40].indexOf(event.keyCode)>-1){
						//prevent arrow keys and space from scrolling the page
						event.preventDefault();
					}
					if(event.keyCode==32){
						player.play();
					}
					editor.handleKey(event.which);
					drawer.drawTab(currTrack);
					drawer.drawSelector(editor.selected);
				}
			});
		</script>
</html>